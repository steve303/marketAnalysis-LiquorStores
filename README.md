# marketAnalysis-LiquorStores

Iowa Liquor Store Business Analysis and Location Selection  
Video link: https://www.dropbox.com/s/9b0d4uolzlwckp6/SU-finalP.mp4?dl=0  
Steve Su  
CSCI 3287  
12/9/2019  

Introduction:  
The concrete objective of this study is to find profitable areas to open up a liquor store in Iowa City.  Determination was done solely through use of public data bases.  Although the study was hypothetical, another major goal of this study was to discover a computational process by selecting and using appropriate tools to answer the question above.  After a process has been established, the methodology can be extrapolated to answer future inquiries.    
To start this process I used several data bases available on Google’s Big Query application.  These included, Iowa Department of Commerce liquor sales data base and US census geographic and demographic related data bases .   Google’s Big query provides a nice interface to pull in these large data sets.  

The basic procedure was to perform queries and generate tables which focused on statistics of the overall liquor store business in Iowa City.  For example, statistics such as population growth and number of stores over the last five years were examined.  The next level was to drill down to store level sales data and neighborhood demographics.  Lastly, selection of a store location was performed.  This involved postGIS using postgreSQL in Google’s Cloud SQL application.  Graphics were produced using various Python libraries such as Matplotlib and Geopandas.  To make the process more seamless between using Jupyter Notebook and Google Cloud Platform, SQLalchemy was used.  This allowed for some tasks to be automated by creating functions to retrieve data from Google Cloud and plot the results automatically in Jupyter Notebook.  

Public Databases Used:  
The main data bases used in this study were directly available using Google’s big query tool.  These included 1) Iowa liquor sales, 2) US census population statistics by tract (2012 -2016) , 3)  US census geographical tract data.  The Iowa liquor sales database contained sales for bottled spirits, meaning no beer and wine, nonetheless it should provide valuable information of overall alcohol sales.  Each tuple in the data base is a sale from the Iowa alcohol commission to an individual store.  Things such as store name, address, GPS coordinates, sales in dollars, bottles sold, product name, invoice_id (primary key) were included.  I was able to collect data from the years 2012 to 2016.  However some of 2016 was incomplete.  The size of the database was over 4 GBs.  The other data bases used were the US census population tract statistics.  There was one for each year from 2012 to 2016.  In total the 5 databases were just over 0.5 GBs.  These databases were helpful to find things like employment characteristics and population of persons over 25 for a given census tract.  I later found out that a tract has finer resolution than breakdown than zip codes.  A tract is designed to represent a neighborhood of approximately 4000 persons.   A geo_id is a unique identifier for a given neighborhood.  I used this make comparisons between different neighborhoods.  Lastly, I was able to use US census geographical tract data for geo comparisons using postgreSQL queries.  

Table Creation:  
To get an overview of the liquor business in Iowa City I performed an aggregate analysis of historical statistics on, sales, adult population, number of stores, and store locations for a given year.  To create these tables I used the main Iowa liquor data base and performed many union all joins filtering by year grouping by store_name and performing aggregate operations.  This gave me a table that I could reference to by store name.  I called this the sales table.  To get a table broken down by yearly statistics I used census data and combined data bases for the years 2012-2015 and searched for the adult population (over 25years) summing over all tracts in Iowa city as defined by their geo_id.  I called this table, pop25over.  By using the sales and pop25over tables I created a table called IowaAggregate where I combined columns of both tables and also created new columns such as persons to store ratio, persons to sales ratio.  This table was helpful to identify some key metrics at a city level.  

To perform census queries of each liquor store to its census tract I used postgreSQL to create a table called liquorStoreTract which related each liquor store to its geo_id census tract.  I was able to determine each store’s geo_id by seeing if its Point intersected with the census’ tract Polygon.  Now I was able to create a table which related a liquor store to its census demographics data.  I called this table empByLiqStoreTract because I used employment data.  For this table I just used latest data available, year 2016.  Each of these tables are shown below in the entity relationship diagram through the use of MySQL Workbench.  

![pic](./images/iowa_er_diagram.png)  
Fig. 1  Entity Relation (ER) diagram  

